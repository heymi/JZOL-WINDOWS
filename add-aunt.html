<html>
<header>
    <script src="js/allBiz.js"></script>
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
    <script src="js/bootstrap-datetimepicker.js"></script>
    <script src="js/dropzone.js"></script>
    <script src="js/jquery-validation/dist/jquery.validate.js"></script>
    <script src="js/data/areas.js"></script>
</header>
<body>
<script>
    var auntExists = false;
    var auntId = '';
    function checkAuntExists(rec) {
        var param = {};
        param.identity = rec.value;
        $.ajax({
            url: 'http://api.jiazhengol.com/employee/identity',
            type: 'POST',
            data: param,
            success: function (returnData) {
                var returnObj = parseJSON(returnData);
                if (returnObj.code == '0') {
                    auntExists = true;
                    auntId = returnObj.data.id;
                    $("#name").val(returnObj.data.name);
                    $("#sex input[value=" + returnObj.data.sex + "]").prop('checked', true);
//                    $("#qualification input[value="+ returnObj.data.qualification +"]").prop('checked', true);
                    $("#phone").val(returnObj.data.phone);
                    $("#age").val(returnObj.data.age);
                    $("#nationality").val(returnObj.data.nationality);
                    $("#stature").val(returnObj.data.stature);
                    $("#body").val(returnObj.data.body);
                    $("#qualification input[value=" + returnObj.data.qualification + "]").prop('checked', true);
                    $("#age").val(returnObj.data.age);
                } else {
                    auntExists = false
                    delete auntId;
//                    $('#basicInfoForm')[0].reset();
                }
            },
            error: function () {
                auntExists = false
                delete auntId;
//                $('#basicInfoForm')[0].reset();
            }
        })
    }

    $(function () {
        var employeeId = getQueryString('employeeId');

        if (employeeId) {
            auntExists = true;
            auntId = employeeId;
            var paramData = {employee_id: employeeId};

            $.ajax({
                url: 'http://api.jiazhengol.com/employee/detail',
                type: 'POST',
                data: paramData,
                success: function (ret) {
                    var retObj = JSON.parse(ret);
//                    $('#native_section').hide();
                    $('#add_or_edit').text('编辑阿姨');

                    //基本信息
                    $("#identity").val(retObj.data.static.identity);
                    $("#name").val(retObj.data.static.name);
                    $("#sex input[value=" + retObj.data.static.sex + "]").prop('checked', true);
                    $("#qualification input[value=" + retObj.data.static.qualification + "]").prop('checked', true);
                    $("#phone").val(retObj.data.static.phone);
                    $("#age").val(retObj.data.static.age);
                    $("#nationality").val(retObj.data.static.nationality);
                    $("#stature").val(retObj.data.static.stature || '');
                    $("#body").val(retObj.data.static.body || '');
                    $("#identity").val(retObj.data.static.identity);
                    $("#marriage").val(retObj.data.static.marriage);
                    $("#family").val(retObj.data.static.family);
                    $("#content").val(retObj.data.static.content);
                    $('#career').val(retObj.data.static.career);
//                    $("#addr").val(retObj.data.static.addr);

                    $('#native_provcityarea').province_city_area(retObj.data.static.native_prov,retObj.data.static.native_city,retObj.data.static.native_area);
                $('#native_addr').val(retObj.data.static.native_address);
                    $('#native_provcityarea select').prop('disabled', 'disabled');
                    $('#native_addr').prop('disabled', 'disabled');
                $('#living_provcityarea').province_city_area(retObj.data.static.living_prov,retObj.data.static.living_city,retObj.data.static.living_area);
                $('#living_addr').val(retObj.data.static.living_address);

                    $('#expected_salary').val(retObj.data.static.expect_salary || '')
                    $('#daily_salary').val(retObj.data.static.daily_salary || '')

                    //工作信息
                    setMultiSelectValue('service_range', retObj.data.dynamic.service_range)
                    setMultiSelectValue('status', retObj.data.dynamic.status)
                    setMultiSelectValue('type', retObj.data.dynamic.type)
//                $('#expected_salary').val(retObj.data.static.expected_salary)
//                $('#daily_salary').val(retObj.data.static.daily_salary)
                    $('#arrival_time').val(retObj.data.dynamic.arrival_time)
                    $('#emergency').val(retObj.data.dynamic.emergency)
                    $('#relationship').val(retObj.data.dynamic.relationship)
                    $('#linkman_tel').val(retObj.data.dynamic.linkman_tel)
                    $('#remark').val(retObj.data.dynamic.remark)
                }
            })
        }
    })


</script>
<div class="container" style="background-color: #FFF"><!-- 右侧开始 -->
    <div class="content-wrapper">
        <div class="content-header-inner">
            <div class="bread-nav float-left">
                <ol class="breadcrumb">
                    <li><a href="aunt.html">阿姨管理</a></li>
                    <li class="active"><strong id="add_or_edit">新增阿姨</strong></li>
                </ol>
            </div>

            <div class="header-action float-right">

                <button type="button" class="btn-blue mgl7 fr" style="display: none">使用身份证阅读器录入</button>

            </div>

        </div>
        <div class="form-dialog">
            <div class="form-content clearfix">

                <div class="form-body" id="basicInfo">
                    <div class="modal-body-wrapper">
                        <form class="form-inline" id="basicInfoForm" role="form">
                            <h5 class="form-title">基本资料</h5>

                            <div class="form-group">
                                <label id="" for=""><span class="enter-need">*</span>身份证号：</label>
                                <input type="text" class="form-control form-control-2x" id="identity"
                                       onchange="checkAuntExists(this)" required>

                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group">
                                <label for="name"><span class="enter-need">*</span>阿姨姓名：</label>
                                <input type="text" class="form-control form-control-1x" maxlength="10" id="name" required>

                                <div class="form-group" id="sex" required="true">
                                    <label>性别：</label>
                                    <label class="radio">
                                        <input type="radio" disabled name="gender" id="male" value="1"> 男
                                    </label>
                                    <label class="radio">
                                        <input type="radio" disabled name="gender" id="female" value="0" checked> 女
                                    </label>
                                </div>
                            </div>

                            <!--<div class="form-group" id="status">-->
                            <!--<label for="status">状态：</label>-->
                            <!--<label class="radio">-->
                            <!--<input type="radio" name="status" id="available" value="0"> 待岗-->
                            <!--</label>-->
                            <!--<label class="radio">-->
                            <!--<input type="radio" name="status" id="onJob" value="1"> 在职-->
                            <!--</label>-->
                            <!--</div>-->
                            <div class="form-group">
                                <label for=""><span class="enter-need">*</span>联系电话：</label>
                                <input type="text" class="form-control form-control-2x" id="phone">
                                <label for="age">年龄：</label>
                                <input type="text" readonly class="form-control form-control-1x" id="age">
                            </div>
                            <div class="form-group" id="native_section">
                                <label for="native_prov"><span class="enter-need">*</span>籍贯：</label>
                                <div class="prov-city-area" id="native_provcityarea"></div>
                                <input type="text" class="form-control" id="native_addr">
                            </div>
                            <div class="form-group">
                                <label for="native_prov"><span class="enter-need">*</span>现居地址：</label>
                                <div class="prov-city-area" id="living_provcityarea"></div>
                                <input type="text" class="form-control" id="living_addr">
                            </div>
                            <div class="form-group">
                                <label for="marriage">婚姻状况：</label>
                                <select class="form-control" id="marriage">
                                    <option value="1">已婚</option>
                                    <option value="0">未婚</option>
                                    <option value="－1">离异</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="">工作经验：</label>
                                <input id="career" type="text" class="form-control"> 年
                            </div>
                            <div class="form-group">
                                <label for="">期望薪资：</label>
                                月薪：
                                <input id="expected_salary" type="text" class="form-control">
                                时薪：
                                <input id="daily_salary" type="text" class="form-control">
                            </div>
                            <div class="form-group">

                                <label for="nationality">民族：</label>
                                <input type="text" class="form-control form-control-1x" id="nationality">
                                <!--<label for="zodiac_sign">属相：</label>-->
                                <!--<select class="form-control" id="zodiac_sign">-->
                                    <!--<option value="1">鼠</option>-->
                                    <!--<option value="2">牛</option>-->
                                    <!--<option value="3">虎</option>-->
                                    <!--<option value="4">兔</option>-->
                                    <!--<option value="5">龙</option>-->
                                    <!--<option value="6">蛇</option>-->
                                    <!--<option value="7">马</option>-->
                                    <!--<option value="8">羊</option>-->
                                    <!--<option value="9">猴</option>-->
                                    <!--<option value="10">鸡</option>-->
                                    <!--<option value="11">狗</option>-->
                                    <!--<option value="12">猪</option>-->
                                <!--</select>-->
                                <!--<label for="exampleInputPassword1">星座：</label>-->
                                <!--<select class="form-control">-->
                                    <!--<option value="不限">狮子座</option>-->
                                    <!--<option value="江苏">处女座</option>-->
                                    <!--<option value="不限">双子座</option>-->
                                    <!--<option value="江苏">射手座</option>-->
                                    <!--<option value="不限">金牛座</option>-->
                                    <!--<option value="江苏">天蝎座</option>-->
                                <!--</select>-->
                            </div>
                            <div class="form-group">
                                <label for="stature">身高：</label>
                                <input type="text" class="form-control form-control-1x" id="stature"> cm
                                <label for="body">体重：</label>
                                <input type="text" class="form-control form-control-1x" id="body"> 斤
                            </div>

                            <div class="form-group">
                                <label for="qualification">学历：</label>

                                <div class="radio-group" id="qualification">
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="1">
                                        小学
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="2">
                                        初中
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="3">
                                        高中
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="4">
                                        大专
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="5">
                                        本科
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="6">
                                        其他
                                    </label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="form-info fl">
						      		<p>注：<span class="enter-need">*</span>为必填项</p>

						      </div>
                <div class="form-footer float-right">
                    <button type="button" class="btn-none" data-toggle="modal" data-target=".bs-example-modal-sm">放弃</button>

                    <button id="message_trigger_ok" type="button" class="btn-green-big">下一步</button>
                </div>
            </div>
            <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">放弃添加</h4>
                        </div>
                        <div class="modal-body">
                            您确定放弃当前添加？
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" id="cancel_add">放弃</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- container end -->
</div>
</section>

</body>

<script type="text/javascript">
    $("#identity").bind('blur',function(){
        var identity = $(this).val();
        var id_pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/i;
        if(!id_pattern.test(identity)){
            $.scojs_message('请输入正确的身份证号码', $.scojs_message.TYPE_ERROR);
        }
        if (parseInt(identity.substr(16, 1),10) % 2 == 1) {
            $('#male').prop('checked',true);
        } else {
            $('#female').prop('checked',true);
        }
        //获取年龄
        var myDate = new Date();
        var month = myDate.getMonth() + 1;
        var day = myDate.getDate();

        var age = myDate.getFullYear() - identity.substring(6, 10) - 1;
        if (identity.substring(10, 12) < month || identity.substring(10, 12) == month && identity.substring(12, 14) <= day) {
            age++;
        }
        $('#age').val(age);
        //获取籍贯
        var nativeNo = identity.substr(0, 6)
        var areaName = _.find(districtData.district, function(district) {
            return district.id == nativeNo;
        });
        var area = _.find(parent.window.PROVCITYAREA.areaData, function(area) {
            return area.name == areaName.text;
        });
        var area_id = area.id;
        var city_id = area.city_id;
        var provData = _.find(parent.window.PROVCITYAREA.cityData, function(province) {
            return province.id == area.city_id;
        });
        var province_id = provData.province_id;
        $('#native_provcityarea').province_city_area(province_id,city_id,area_id);
        $('#native_provcityarea select').prop('disabled', 'disabled');
    });
    $("#name").bind('blur',function(){
       var name = $(this).val();
        if($.trim(name).length === 0){
            $.scojs_message('请输入长度在10字符以内的姓名', $.scojs_message.TYPE_ERROR);
        }
    });
    $('#message_trigger_ok').on('click', function (e) {

        e.preventDefault();

        var paramObj = {};
        paramObj.name = $("#name").val();
        paramObj.sex = $("#sex input:checked").val();
        paramObj.phone = $("#phone").val();
        var identity = $("#identity").val();
        paramObj.identity = identity;
        paramObj.age = $("#age").val();
//        if(!auntExists){
            paramObj.native_prov= $('#native_provcityarea .prov-select').val();
            paramObj.native_city= $('#native_provcityarea .city-select').val();
            paramObj.native_area= $('#native_provcityarea .area-select').val();
            paramObj.native_address = $('#native_addr').val();
//        }
        if($('#nationality').val()){
            paramObj.nationality = $('#nationality').val();
        }
//        paramObj.zodiac_sign = '1';
        if($("#body").val()){
            paramObj.body = $("#body").val();
        }
        if($("#stature").val()){
            paramObj.stature = $("#stature").val();
        }
        paramObj.qualification = $("#qualification input:checked").val();
        paramObj.living_prov= $('#living_provcityarea .prov-select').val();
 		paramObj.living_city= $('#living_provcityarea .city-select').val();
 		paramObj.living_area= $('#living_provcityarea .area-select').val();
        paramObj.living_address = $('#living_addr').val();
        paramObj.marriage = $('#marriage').val();
        if($('#career').val()){
            paramObj.career = $('#career').val();
        }
        if($('#expected_salary').val()){
            paramObj.expect_salary = $('#expected_salary').val();
        }
        if($('#daily_salary').val()){
            paramObj.daily_salary = $('#daily_salary').val();
        }


        var postUrl = '';
        if (auntExists) {
            postUrl = "http://api.jiazhengol.com/employee/update";
        } else {
            postUrl = "http://api.jiazhengol.com/employee/add";
        }
        $.ajax({
            url: postUrl,
            type: 'POST',
            data: paramObj,
            success: function (ret) {
                var retObj = JSON.parse(ret);
                if (retObj.code == '0') {
                    if (auntExists) {
                        parent.document.getElementById("rightContent").setAttribute("src", "addAunt-JobDetail.html?employeeId=" + auntId + "&isUpdate=" + auntExists);
                    } else {
                        parent.document.getElementById("rightContent").setAttribute("src", "addAunt-JobDetail.html?employeeId=" + retObj.data.id + "&isUpdate=" + auntExists);
                    }
                }else{
					$.scojs_message(errorCode["code_" + retObj.code], $.scojs_message.TYPE_ERROR)
				}
            },
            error: function (ret) {
                $.scojs_message('服务器异常错误', $.scojs_message.TYPE_ERROR)
            }
        })

    });
    $('#datetimepicker').datetimepicker({
        format: 'yyyy-mm-dd hh:ii'
    });
    $('#cancel_add').on('click', function(){
        parent.document.getElementById("rightContent").setAttribute("src", "aunt.html");
    });
    $('.prov-city-area').province_city_area();
    $('#native_provcityarea select').prop('disabled', 'disabled');
</script>
</html>

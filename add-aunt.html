<html>
<header>
    <script src="js/allBiz.js"></script>
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
    <script src="js/bootstrap-datetimepicker.js"></script>
    <script src="js/dropzone.js"></script>
    <script src="js/jquery-validation/dist/jquery.validate.js"></script>
</header>
<body>
<script>
    var auntExists = false;
    var auntId = '';
    function checkAuntExists(rec) {
        var param = {};
        param.identity = rec.value;
        $.ajax({
            url: 'http://test.fuhui.com/employee/identity',
            type: 'POST',
            data: param,
            success: function (returnData) {
                var returnObj = parseJSON(returnData);
                if (returnObj.code == '0') {
                    auntExists = true;
                    auntId = returnObj.data.id;
                    $("#name").val(returnObj.data.name);
                    $("#sex input[value=" + returnObj.data.sex + "]").prop('checked', true);
//                    $("#qualification input[value="+ returnObj.data.qualification +"]").prop('checked', true);
                    $("#phone").val(returnObj.data.phone);
                    $("#age").val(returnObj.data.age);
                    $("#nationality").val(returnObj.data.nationality);
                    $("#stature").val(returnObj.data.stature);
                    $("#body").val(returnObj.data.body);
                    $("#qualification input[value=" + returnObj.data.qualification + "]").prop('checked', true);
                    $("#age").val(returnObj.data.age);
                } else {
                    auntExists = false
                    delete auntId;
//                    $('#basicInfoForm')[0].reset();
                }
            },
            error: function () {
                auntExists = false
                delete auntId;
//                $('#basicInfoForm')[0].reset();
            }
        })
    }

    $(function () {
        var employeeId = getQueryString('employeeId');

        if (employeeId) {
            auntExists = true;
            auntId = employeeId;
            var paramData = {employee_id: employeeId};

            $.ajax({
                url: 'http://test.fuhui.com/employee/detail',
                type: 'POST',
                data: paramData,
                success: function (ret) {
                    var retObj = JSON.parse(ret);

                    //基本信息
                    $("#identity").val(retObj.data.static.identity);
                    $("#name").val(retObj.data.static.name);
                    $("#sex input[value=" + retObj.data.static.sex + "]").prop('checked', true);
                    $("#qualification input[value=" + retObj.data.static.qualification + "]").prop('checked', true);
                    $("#phone").val(retObj.data.static.phone);
                    $("#age").val(retObj.data.static.age);
                    $("#nationality").val(retObj.data.static.nationality);
                    $("#stature").val(retObj.data.static.stature);
                    $("#body").val(retObj.data.static.body);
                    $("#identity").val(retObj.data.static.identity);
                    $("#family").val(retObj.data.static.family);
                    $("#content").val(retObj.data.static.content);
//                    $("#addr").val(retObj.data.static.addr);

                    $('#native_provcityarea').province_city_area(retObj.data.static.native_prov,retObj.data.static.native_city,retObj.data.static.native_area);
                $('#native_addr').val(retObj.data.static.native_address);
                $('#living_provcityarea').province_city_area(retObj.data.static.living_prov,retObj.data.static.living_city,retObj.data.static.living_area);
                $('#living_addr').val(retObj.data.static.living_address);

                    $('#expected_salary').val(retObj.data.static.expect_salary)
                    $('#daily_salary').val(retObj.data.static.daily_salary)

                    //工作信息
                    setMultiSelectValue('service_range', retObj.data.dynamic.service_range)
                    setMultiSelectValue('status', retObj.data.dynamic.status)
                    setMultiSelectValue('type', retObj.data.dynamic.type)
//                $('#expected_salary').val(retObj.data.static.expected_salary)
//                $('#daily_salary').val(retObj.data.static.daily_salary)
                    $('#arrival_time').val(retObj.data.dynamic.arrival_time)
                    $('#emergency').val(retObj.data.dynamic.emergency)
                    $('#relationship').val(retObj.data.dynamic.relationship)
                    $('#linkman_tel').val(retObj.data.dynamic.linkman_tel)
                    $('#remark').val(retObj.data.dynamic.remark)
                }
            })
        }
    })


</script>
<div class="container" style="background-color: #FFF"><!-- 右侧开始 -->
    <div class="content-wrapper">
        <div class="content-header-inner">
            <div class="bread-nav float-left">
                <ol class="breadcrumb">
                    <li><a href="aunt.html">阿姨管理</a></li>
                    <li class="active"><strong>新增阿姨</strong></li>
                </ol>
            </div>

            <div class="header-action float-right">

                <button type="button" class="btn-blue mgl7 fr">使用身份证阅读器录入</button>

            </div>

        </div>
        <div class="form-dialog">
            <div class="form-content clearfix">

                <div class="form-body" id="basicInfo">
                    <div class="modal-body-wrapper">
                        <form class="form-inline" id="basicInfoForm" role="form">
                            <h5 class="form-title">基本资料</h5>

                            <div class="form-group">
                                <label id="" for=""><span class="enter-need">*</span>身份证号：</label>
                                <input type="text" class="form-control form-control-2x" id="identity"
                                       onchange="checkAuntExists(this)" required>

                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group">
                                <label for="name"><span class="enter-need">*</span>阿姨姓名：</label>
                                <input type="text" class="form-control form-control-1x" id="name" required>

                                <div class="form-group" id="sex" required="true">
                                    <label><span class="enter-need">*</span>性别：</label>
                                    <label class="radio">
                                        <input type="radio" name="gender" id="male" value="1"> 男
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="gender" id="female" value="0" checked> 女
                                    </label>
                                </div>
                            </div>

                            <!--<div class="form-group" id="status">-->
                            <!--<label for="status">状态：</label>-->
                            <!--<label class="radio">-->
                            <!--<input type="radio" name="status" id="available" value="0"> 待岗-->
                            <!--</label>-->
                            <!--<label class="radio">-->
                            <!--<input type="radio" name="status" id="onJob" value="1"> 在职-->
                            <!--</label>-->
                            <!--</div>-->
                            <div class="form-group">
                                <label for=""><span class="enter-need">*</span>联系电话：</label>
                                <input type="text" class="form-control form-control-2x" id="phone">
                                <label for="age"><span class="enter-need">*</span>年龄：</label>
                                <input type="text" class="form-control form-control-1x" id="age">
                            </div>
                            <div class="form-group">
                                <label for="native_prov"><span class="enter-need">*</span>籍贯：</label>
                                <div class="prov-city-area" id="native_provcityarea"></div>
                                <input type="text" class="form-control" id="native_addr">
                            </div>
                            <div class="form-group">
                                <label for="native_prov"><span class="enter-need">*</span>现居地址：</label>
                                <div class="prov-city-area" id="living_provcityarea"></div>
                                <input type="text" class="form-control" id="living_addr">
                            </div>
                            <div>
                                <label for="">期望薪资：</label>
                                月薪：
                                <input id="expected_salary" type="text" class="form-control">
                                时薪：
                                <input id="daily_salary" type="text" class="form-control">
                            </div>
                            <div class="form-group">

                                <label for="nationality">民族：</label>
                                <input type="text" class="form-control form-control-1x" id="nationality">
                                <label for="zodiac_sign">属相：</label>
                                <select class="form-control" id="zodiac_sign">
                                    <option value="1">鼠</option>
                                    <option value="2">牛</option>
                                    <option value="3">虎</option>
                                    <option value="4">兔</option>
                                    <option value="5">龙</option>
                                    <option value="6">蛇</option>
                                    <option value="7">马</option>
                                    <option value="8">羊</option>
                                    <option value="9">猴</option>
                                    <option value="10">鸡</option>
                                    <option value="11">狗</option>
                                    <option value="12">猪</option>
                                </select>
                                <!--<label for="exampleInputPassword1">星座：</label>-->
                                <!--<select class="form-control">-->
                                    <!--<option value="不限">狮子座</option>-->
                                    <!--<option value="江苏">处女座</option>-->
                                    <!--<option value="不限">双子座</option>-->
                                    <!--<option value="江苏">射手座</option>-->
                                    <!--<option value="不限">金牛座</option>-->
                                    <!--<option value="江苏">天蝎座</option>-->
                                <!--</select>-->
                            </div>
                            <div class="form-group">
                                <label for="stature">身高：</label>
                                <input type="text" class="form-control form-control-1x" id="stature"> cm
                                <label for="body">体重：</label>
                                <input type="text" class="form-control form-control-1x" id="body"> 斤
                            </div>

                            <div class="form-group">
                                <label for="qualification">学历：</label>

                                <div class="radio-group" id="qualification">
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="1">
                                        小学
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="2">
                                        初中
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="3">
                                        高中
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="4">
                                        大专
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="5">
                                        本科
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="inlineRadioOptions" value="6">
                                        其他
                                    </label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="form-info fl">
						      		<p>注：<span class="enter-need">*</span>为必填项</p>

						      </div>
                <div class="form-footer float-right">
                    <button type="button" class="btn-none" data-dismiss="modal">放弃</button>

                    <button id="message_trigger_ok" type="button" class="btn-green-big">下一步</button>
                </div>
            </div>
        </div>
    </div>
    <!-- container end -->
</div>
</section>

</body>

<script type="text/javascript">
    $('#message_trigger_ok').on('click', function (e) {

        e.preventDefault();

        var paramObj = {};
        paramObj.name = $("#name").val();
        paramObj.sex = $("#sex input:checked").val();
        paramObj.phone = $("#phone").val();
        paramObj.identity = $("#identity").val();
        paramObj.age = $("#age").val();
        paramObj.native_prov= $('#native_provcityarea .prov-select').val();
 		paramObj.native_city= $('#native_provcityarea .city-select').val();
 		paramObj.native_area= $('#native_provcityarea .area-select').val();
        paramObj.native_address = $('#native_addr').val();
        paramObj.marriage = "1";
        if($('#nationality').val()){
            paramObj.nationality = $('#nationality').val();
        }
//        paramObj.zodiac_sign = '1';
        if($("#body").val()){
            paramObj.body = $("#body").val();
        }
        if($("#stature").val()){
            paramObj.stature = $("#stature").val();
        }
        paramObj.qualification = $("#qualification input:checked").val();
        paramObj.living_prov= $('#living_provcityarea .prov-select').val();
 		paramObj.living_city= $('#living_provcityarea .city-select').val();
 		paramObj.living_area= $('#living_provcityarea .area-select').val();
        paramObj.living_address = $('#living_addr').val();
        paramObj.expect_salary = $('#expect_salary').val();
        if($('#daily_salary').val()){
            paramObj.daily_salary = $('#daily_salary').val();
        }


        var postUrl = '';
        if (auntExists) {
            postUrl = "http://test.fuhui.com/employee/update";
        } else {
            postUrl = "http://test.fuhui.com/employee/add";
        }
        $.ajax({
            url: postUrl,
            type: 'POST',
            data: paramObj,
            success: function (ret) {
                var retObj = JSON.parse(ret);
                if (retObj.code == '0') {
                    if (auntExists) {
                        parent.document.getElementById("rightContent").setAttribute("src", "addAunt-JobDetail.html?employeeId=" + auntId + "&isUpdate=" + auntExists);
                    } else {
                        parent.document.getElementById("rightContent").setAttribute("src", "addAunt-JobDetail.html?employeeId=" + retObj.data.id + "&isUpdate=" + auntExists);
                    }
                }
            },
            error: function (ret) {
                alert('error');
            }
        })

    });
    $('#datetimepicker').datetimepicker({
        format: 'yyyy-mm-dd hh:ii'
    });
    $('.prov-city-area').province_city_area();
</script>
</html>

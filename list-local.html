<!DOCTYPE html>
<html>
<header>
    <script src="js/allBiz.js"></script>
    <link href="js/bootgrid/jquery.bootgrid.css" rel="stylesheet"/>
    <script src="js/bootgrid/jquery.bootgrid.js"></script>
    <script src="js/bootgrid/jquery.bootgrid.fa.js"></script>
    <script>
        var list_paramMap = {
            source: {
                0: '未选择',
                1: '本地',
                2: '网络',
                3: '家政在线'
            },
            type: {
                1: '临时钟点工',
                2: '长期钟点工',
                3: '保姆',
                4: '育儿嫂',
                5: '疾病护理',
                6: '老人护理',
                7: '月嫂',
                8: '早教',
                9: '催乳师'
            },
            status: {
                0: '待处理',
                1: '试工中',
                2: '服务中',
                3: '已完成',
                4: '试工失败',
                5: '需求终止',
                6: '已取消'
            }
        }
    </script>
</header>
<script>
    function firstPageHandler() {
        $("#gridTable").children('tr').each(function () {
            if ($(this).next().size() > 0) {
                $(this).prev().before(this)
            }
        })
        $(".active").removeClass("active");
        $(".firstPage").addClass("active");
    }
    function secondPageHandler() {
        $("#gridTable").children('tr').each(function () {
            if ($(this).next().size() > 0) {
                $(this).prev().before(this)
            }
        })
        $(".active").removeClass("active");
        $(".secondPage").addClass("active");
    }


    function thirdPageHandler() {
        $("#gridTable").children('tr').each(function () {
            if ($(this).next().size() > 0) {
                $(this).prev().before(this)
            }
        })
        $(".active").removeClass("active");
        $(".thirdPage").addClass("active");
    }
</script>
<body>
<div class="container"><!-- 右侧开始 -->

    <div class="content-wrapper">
        <!-- 面包屑导航样式开始 -->
        <div class="content-header-inner clearfix">

            <div class="bread-nav float-left">
                <ol class="breadcrumb">
                    <li><a href="list-local.html">订单管理</a></li>
                    <li class="active"><strong>本地订单</strong></li>
                </ol>
            </div>

            <div class="header-tab float-left">
                <div class="btn-group" role="group" aria-label="...">
                    <ul>
                        <li role="presentation" class="active"><a href="list-local.html" class="first-child">本地订单</a>
                        </li>
                        <li role="presentation"><a href="list-shared.html">分享订单</a></li>
                        <li role="presentation"><a href="list-history.html" class="last-child">历史订单</a></li>
                    </ul>
                </div>
            </div>

            <div class="header-action float-right" style="display: none">
                <button type="button" class="btn-blue mgl7 fr" onClick="location.href='add-list.html'">新增订单</button>

                <div class="input-group float-right">
                    <i class="fa fa-search"></i>
                    <input type="text" class="search-from form-control" placeholder="搜索订单">
                </div>

            </div>

        </div>
        <!-- 面包屑导航样式结束-->

        <!-- 面包屑导航样式结束 -->
        <div class="tab-content">


            <div class="normal-table">
                <div class="normal-table">
                    <!-- 内容表格开始 -->
                    <table id="dataGrid" class="table table-condensed table-hover table-striped" data-selection="true"
                           data-multi-select="true" data-row-select="true" data-keep-selection="true">
                        <thead>
                        <tr>
                            <th data-column-id="id" data-identifier="true" data-width="0px"></th>
                            <th data-column-id="bill_status" data-identifier="true" data-width="0px"></th>
                            <th data-column-id="employer_name" data-identifier="true">雇主</th>
                            <th data-column-id="employee_name" data-identifier="true">阿姨</th>
                            <th data-column-id="employee_phone" data-identifier="true">联系电话</th>
                            <th data-column-id="create_at" data-width="15%">订单生成时间</th>
                            <th data-column-id="type">服务类型</th>
                            <th data-column-id="source">来源</th>
                            <th data-column-id="status">状态</th>
                            <th data-column-id="operations" class="action-th">操作</th>
                        </tr>
                        </thead>
                    </table>
                    <!--<div style="display:inline">-->
                        <!--<button type="button" class="btn-grey-danger" style="margin:20px 0;" data-toggle="modal"-->
                                <!--data-target=".modal-del">删除-->
                        <!--</button>-->
                    <!--</div>-->

                </div>
                <!-- 内容表格结束 -->
            </div>
            <!-- 需求卡片结束 -->


            <!-- Modal -->
            <div class="modal fade" id="shareList" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">分享设置</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-content">

                                <div class="form-body">
                                    <div class="modal-body-wrapper">
                                        <form class="form-inline">

                                            <div class="form-group">
                                                <label for="">分享时间：</label>
                                                <input type="text" class="form-control form-control-2x datetimepicker"
                                                       value=""><span class="input-span">到</span>
                                                <input type="text" class="form-control form-control-2x datetimepicker">

                                            </div>

                                            <div class="form-group">
                                                <label for="">分享范围：</label>
                                                <!-- Small button group -->
                                                <select class="form-control form-control-1x
												">
                                                    <option value="">所有门店</option>
                                                </select>

                                            </div>

                                            <div class="form-group">
                                                <label class="laber-pading">负责人：</label>
                                                <input type="text" class="form-control form-control-2x" value="">


                                            </div>

                                            <div class="form-group">
                                                <label for="">联系电话：</label>
                                                <input type="text" class="form-control form-control-2x" value="">


                                            </div>

                                        </form>


                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-none" data-dismiss="modal">取消</button>
                            <button type="button" class="btn-green" onClick="location.href='list-shared.html'">确认分享
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">放弃添加</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="">放弃原因？</label>
                                <!-- Small button group -->
                                <select class="form-control form-control-1x
												">
                                    <option value="仅限友店">无合适阿姨</option>
                                    <option value="公开">临时决定取消</option>
                                </select>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary">放弃</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade modal-del" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">删除订单？</h4>
                        </div>
                        <div class="modal-body">
                            您确定删除当前选择的订单？
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- content-wrapper over -->
    </div>
    <!-- 订单管理结束 -->

<script>
    $(function () {
                function init() {
                    $("#dataGrid").bootgrid({
                                ajax: true,
                                url: function(){
                                    var searchPhrase = $("#dataGrid").bootgrid("getSearchPhrase");
                                    if(searchPhrase.length){
                                        return "http://api.jiazhengol.com/demands/list";
                                    }else{
                                        return "http://api.jiazhengol.com/demands/list";
                                    }
                                },
                                responseHandler: function (res) {
                                    if(res.code === -1){
                                        $.scojs_message('登录失效，请退出后请重新登录！', $.scojs_message.TYPE_ERROR);
                                      }
                                    var retResult = {
                                        "current": 1,
                                        "rows": []
                                    }
                                    retResult["rows"] = res.data.list;
                                    retResult["rowCount"] = res.data.list.length;
                                    retResult["total"] = res.data.pager.count;
                                    retResult["current"] = res.data.pager.page;
                                    return retResult;
                                },
                                formatters: {
                                    "operations": function (column, row) {
                                        var status = row.bill_status || row.status;
                                        switch (status){
                                            case 0:
                                                return "<button type=\"button\" class=\"btn-yellow-small\" onClick=\"location.href='order-wait.html?orderId=" + row.id + "'\">匹配阿姨</button>";
                                            case 1:
                                                return "<button type=\"button\" class=\"btn-blue-small\" onClick=\"location.href='order-setup.html?orderId=" + row.id + "'\">查看详情</button>";
                                            case 3:
                                                return "<button type=\"button\" class=\"btn-blue-small\" onClick=\"location.href='order-finish.html?orderId=" + row.id + "'\">查看详情</button>";
                                            case 5:
                                                return "<button type=\"button\" class=\"btn-grey-small\" onClick=\"location.href='order-abend.html?orderId=" + row.id + "'\">查看详情</button>";
                                            case 6:
                                                return "<button type=\"button\" class=\"btn-grey-small\" onClick=\"location.href='order-canceled.html?orderId=" + row.id + "'\">查看详情</button>";
                                            default :
                                                return "<button type=\"button\" class=\"btn-green-small\" onClick=\"location.href='order-service.html?orderId=" + row.id + "'\">查看详情</button>";
                                        }
                                    },
                                    "employee_name": function(column, row){
                                      if(row.employee_name){
                                          return row.employee_name
                                      }else{
                                          return "未指派"
                                      }
                                    },
                                    "employee_phone": function(column, row){
                                      if(row.employee_phone){
                                          return row.employee_phone
                                      }else{
                                          return "无"
                                      }
                                    },
                                    "create_at": function(column, row){
                                        return new Date(row.create_at*1000).format('yy-mm-dd HH:MM');
                                    },
                                    "type": function (column, row) {
                                        return list_paramMap.type[row.type]
                                    },
                                    "status": function (column, row) {
                                        var status = row.bill_status || row.status;
                                        switch (status){
                                            case 0:
                                                return '<span class="fontyellow">' + list_paramMap.status[status] + '</span>';
                                            case 1:
                                                return '<span class="fontblue">' + list_paramMap.status[status] + '</span>';
                                            case 2:
                                                return '<span class="fontgreen">' + list_paramMap.status[status] + '</span>';
                                            case 3:
                                                return '<span class="fontgreen">' + list_paramMap.status[status] + '</span>';
                                            default :
                                                return list_paramMap.status[status];
                                        }
                                    },
                                    "source": function (column, row) {
                                        return list_paramMap.source[row.source]
                                    }
                                },
                                rowCount: [10, 12, 18],
                                labels: {
                                    infos: "",
                                    search: "搜索订单",
                                    noResults: '没有记录'
                                },
                                padding: 100,
                                templates: {
                                    header: "<div id=\"{{ctx.id}}\" class=\"{{css.header}} shopGridHeader\">" +
                                    "<div class=\"row\">" +
                                    "<div class=\"col-sm-12 actionBar shopActionBar\">" +
                                    "<button type=\"button\" class=\"btn-blue mgl7 fr\" onClick=\"location.href='add-list.html'\">新增订单</button>" +
                                    "<p class=\"{{css.search}}\"></p>" +
//                    "<p class=\"{{css.actions}}\"></p>" +
                                    "</div>" +
                                    "</div>" +
                                    "</div>",
                                    search: ""
                                },
                                css: {
                                    search: "shopSearchField search"
                                }
                            }
                    ).on("selected.rs.jquery.bootgrid", function (e) {
                            });

                }

                init();

                $("#confirmDelete").on("click", function () {
                    var removdeIdsArr = $("#dataGrid").bootgrid("getSelectedRows");
                    var removedIdsStr = '';
                    if (!removdeIdsArr || removdeIdsArr.length == 0) {
                        $('#confirmDeleteModal').modal('hide');
                        return;
                    }
                    removedIdsStr = removdeIdsArr.join(',');
                    $.ajax({
                        url : 'http://api.jiazhengol.com/employer/del?isdel=1&eid=' + removedIdsStr,
                        type : 'GET',
//                        type : 'POST',
                        data : {},
                        success : function (ret) {
                            $('#confirmDeleteModal').modal('hide');
                            $("#dataGrid").bootgrid("remove");
                        },
                        error : function(ret) {
                            alert('内部错误')
                        }
                    })

                });
            }
    );
</script>
</body>
<script type="text/javascript">
    $(document).ready(function () {

        $(".button-slide-menu").on("click", function () {
            $(".slide-menu").toggleClass("slide-menu-show");
            $(".fog-hover").toggleClass("fog");
        });
        $(".fog-hover").on("click", function () {
            $(".slide-menu").toggleClass("slide-menu-show");
            $(".fog-hover").toggleClass("fog");
        });

        $('.datetimepicker').datetimepicker({
            format: 'yyyy-mm-dd hh:ii'
        })

        $('#gridRecDeleteBtn').click(function () {
            $(".gridDataToBeDeleted").remove();
        })

    });
</script>
</html>

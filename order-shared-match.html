<html>
<header>
	<script src="js/allBiz.js"></script>
	<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
	<link href="js/bootgrid/jquery.bootgrid.css" rel="stylesheet"/>
	<script src="js/bootstrap-datetimepicker.js"></script>
	<script src="js/bootgrid/jquery.bootgrid.js"></script>
    <script src="js/bootgrid/jquery.bootgrid.fa.js"></script>
	<script src="js/paramMap.js"></script>
</header>
<body>
<script>
	//定义一个全局变量用于存放推荐阿姨的 post 数据
	var postAuntData = {};
    $(function () {
		function getDemandDetail(callback){
			var orderId = getQueryString('orderId');
			var paramData = {id: orderId};
			$.ajax({
				url: 'http://api.fuhui.com/demands/detail',
				type: 'POST',
				data: paramData,
				success: function (ret) {
					var retObj = JSON.parse(ret).data;
					return callback(retObj);
				}
			})
		}
		function getShopDetail(id,callback){
			var paramData = {id: id};
			$.ajax({
				url: 'http://api.fuhui.com/Shop/detail',
				type: 'POST',
				data: paramData,
				success: function (ret) {
					var retObj = JSON.parse(ret).data;
					return callback(retObj);
				}
			})
		}
		function getAuntDetail(id,callback){
			var paramData = {employee_id: id};

			$.ajax({
				url: 'http://api.fuhui.com/employee/detail',
				type: 'POST',
				data: paramData,
				success: function (ret) {
					var retObj = JSON.parse(ret);
					return callback(retObj.data);
				}
			})
		}
		function init(match_aunt) {
			$("#dataGrid").bootgrid({
						ajax: true,
						post: match_aunt,
						url: "http://api.fuhui.com/employee/list",
						responseHandler: function (res) {
							var retResult = {};
							retResult["rows"] = res.data.list;
							retResult["rowCount"] = res.data.list.length;
							retResult["total"] = res.data.pager.count;
							retResult["current"] = parseInt(res.data.pager.page);
							return retResult;
						},
						formatters: {
							"status": function (column, row) {
								return paramMap.status[row.status]
							},
							"qualification": function (column, row) {
								return paramMap.qualification[row.qualification]
							},
							"service_range": function (column, row) {
								return paramMap.getCodeValue('service_range', row.service_range)
							},
							"operations": function (column, row) {
								return "<!--<button class=\"btn-white-small button-slide-menu\" type=\"button\">查看简历</button>--><button class=\"btn-green-small open-modal\" type=\"button\" data-toggle=\"modal\" data-id=\"" + row.id + "\" data-target=\"#sendingAunt\">推荐</button>";
							},
							"update_time": function (column, row) {
								return getLocalTime(row.update_time)
							}
						},
						rowCount: [10, 12, 18],
						labels: {
							infos: "",
							search: "搜索阿姨",
							noResults: '没有记录'
						},
						padding: 100,
						templates: {
							header: "",
							search: ""
						},
						css: {
							search: "shopSearchField search"
						}
					}
			).on("loaded.rs.jquery.bootgrid", function (e) {
//						$('.button-slide-menu').on("click", function () {
//							$(".slide-menu").toggleClass("slide-menu-show");
//							$(".fog-hover").toggleClass("fog");
//							$('.slide-menu iframe').attr('src', 'aunt-resume.html?employeeId=56');
//						});
//						$(".fog-hover").on("click", function () {
//							$(".slide-menu").toggleClass("slide-menu-show");
//							$(".fog-hover").toggleClass("fog");
//						});
						$('.open-modal').on('click', function (e) {
							e.preventDefault();
							getAuntDetail($(this).attr('data-id'),function(auntdata){
								postAuntData.employee_id = auntdata.static.id;
								postAuntData.employee_shop_status = auntdata.dynamic.status;
								postAuntData.employee_native_prov = auntdata.static.living_prov;
								postAuntData.employee_native_city = auntdata.static.living_city;
								postAuntData.employee_native_area = auntdata.static.living_area;
								postAuntData.employee_native_address = auntdata.static.living_address;
								postAuntData.employee_qualification = auntdata.static.qualification;
								getShopDetail(postAuntData.proposer_id, function(data){
									$('#proposer_name').text(data.name);
									$('#manager_name').text(data.manager_name);
									$('#manager_phone').text(data.manager_phone);
									$('#suggest_aunt').modal('show');
									$('#employee_name').text(auntdata.static.name);
									$('#employee_service_range').text(getMultiValue('service_range',auntdata.dynamic.service_range,paramMap));
									$('#proposer_addr').text(data.address);
								});
							});
//							getAuntDetail($(this).attr('data-id'),function(data){
//								$('#contact_employee_name').text(data.employee_name);
//								$('#contact_proposer_name').text(data.proposer_name);
//								$('#contact_employee_native_address').text(data.employee_native_address);
//								$('#contact_bidder_name').text(data.bidder_name);
//								$('#contact_bidder_phone').text(data.bidder_phone);
//								$('#contact_content').text(data.content);
//                                $('#go_to_work').attr('data-id',data.id);
//                                $('#no_suit').attr('data-id',data.id);
//								$('#contactAunt').modal('show');
//							});
							return false;
						});
					});
		}
        getDemandDetail(function(data){
			var demands_info = data.demands_info;

			postAuntData.demand_id = demands_info.id;
			postAuntData.proposer_id = getQueryString('proposerId');
			postAuntData.employer_id = demands_info.employer_id;
			postAuntData.employee_service_range = demands_info.type;
			postAuntData.content = demands_info.content;
			postAuntData.requirement = demands_info.requirements;
			postAuntData.remark = demands_info.remark;

			// 把查询条件存储到 localstorage
			var match_aunt = {};
			match_aunt.service = demands_info.type;
//			match_aunt.qualification = demands_info.employee_education;
			init(match_aunt);
		});
    })
</script>
				<!-- Modal recommend popover -->
	<div class="modal fade" id="suggest_aunt" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="popover-modal-content modal-content">

	        <div class="popover-modal-header modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;	</span></button>
		        <h4 class="pop-title modal-title" id="myModalLabel">阿姨推荐</h4>
	        </div>

		        <div class="modal-body clearfix">
			        <dl class="popover-dl dl-horizontal f16">
						<dt class="gray">推荐阿姨：</dt>
						<dd id="employee_name"></dd>
						<dt class="gray">工种：</dt>
						<dd id="employee_service_range"></dd>
					</dl>
					<dl class="popover-dl dl-horizontal f16">
						<dt class="gray">推荐至：</dt>
						<dd><span id="proposer_name"></span> <span class="gray">地址：</span><span id="proposer_addr"></span></dd>
						<dt class="gray">负责人：</dt>
						<dd id="manager_name"></dd>
						<dt class="gray">电话：</dt>
						<dd id="manager_phone"></dd>
					</dl>
					<form class="">
						<div class="form-group">
							 <label for="bidder_phone">推荐人手机：</label>
								<input id="bidder_phone" type="text" class="form-control form-control-2x" value="">
						</div>
						<div class="form-group">
							 <label for="bidder_tel">推荐人电话：</label>
								<input type="text" id="bidder_tel" class="form-control form-control-2x" value="">
						</div>
					</form>
						<p class="pl10 gray">提醒：一个订单一次只能推荐一个阿姨，如需更换阿姨推荐，需等对方公司答复。</p>
		        </div>

	        <div class="popover-modal-footer modal-footer">
		        <button type="button" class="btn-none btn btn-default" data-dismiss="modal">取消</button>
		        <button id="confirmPromote" type="button" class="btn-blue btn btn-primary"><i class="fa fa-check-circle"></i> 确认推荐</button>
	        </div>

	    </div>
	  </div>
	</div>








			<div class="container">
				<div class="content-wrapper">

					<!-- 面包屑导航样式开始 -->
					<div class="content-header-inner clearfix">
						<div class="bread-nav float-left">
							<ol class="breadcrumb">
								<li><a href="list-local.html">订单管理</a></li>
		 						<li><a href="list-shared.html">分享的订单</a></li>
		 						<li class="active"><strong>符合的阿姨</strong></li>
							</ol>
						</div>

					<div class="header-action float-right">
						<button type="button" class="btn-blue mgl7 fr" data-toggle="modal" data-target="#">全部阿姨</button>



							</div>

						</div>
						<!-- 面包屑导航样式结束 -->
		<!-- 匹配列表开始 -->
	 	<div class="tab-content">
			<div class="normal-table match_table">
			<table id="dataGrid" class="table table-condensed table-hover table-striped" data-selection="true"
                       data-multi-select="true" data-row-select="true" data-keep-selection="true">
                    <thead>
                    <tr>
                        <th data-column-id="id" data-identifier="true" data-width="0px"></th>
                        <th data-column-id="esid" data-identifier="true" data-width="0px"></th>
                        <th data-column-id="name" data-order="asc" data-align="center"
                            data-header-align="center" data-width="100px">姓名
                        </th>
                        <th data-column-id="service_range" class="sort-th" data-width="150px" data-align="left"
                            headerAlign="center">工种
                        </th>
                        <th data-column-id="status" data-width="80px">状态</th>
                        <th data-column-id="native_prov">籍贯</th>
                        <th data-column-id="qualification">学历</th>
                        <th data-column-id="remark">备注</th>
                        <th data-column-id="operations" data-width="180px">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
				</div>
		</div>
		<!-- 匹配列表结束 -->
		 					<!-- Modal -->

			</div>
			<!-- content-wrapper over -->


					</div>
					<!-- 订单管理结束 -->








</body>
<script type="text/javascript">
jQuery(document).ready(function(){
	$(".button-slide-menu").on("click", function (){
							$(".slide-menu").toggleClass("slide-menu-show");
							$(".fog-hover").toggleClass("fog");
		});
	$(".fog-hover").on("click", function (){
							$(".slide-menu").toggleClass("slide-menu-show");
							$(".fog-hover").toggleClass("fog");
	});
	$("#confirmPromote").on("click", function(e) {
		e.preventDefault();
		postAuntData.bidder_phone = $('#bidder_phone').val();
		postAuntData.bidder_tel = $('#bidder_tel').val();
		console.log(postAuntData)
		$.ajax({
            url: "http://api.fuhui.com/DemandsBiddings/add",
            type: 'POST',
            data: postAuntData,
            success: function (ret) {
                var retObj = JSON.parse(ret);
                if (retObj.code == '0') {
                    $.scojs_message('推荐成功', $.scojs_message.TYPE_OK);
					$('#suggest_aunt').modal('hide');
                    setTimeout(function(){
                      parent.document.getElementById("rightContent").setAttribute("src", "list-shared.html");
                    },1e3);
                } else{
					$.scojs_message(errorCode['code_' + retObj.code], $.scojs_message.TYPE_ERROR);
				}
            },
            error: function (ret) {
                $.scojs_message('推荐失败', $.scojs_message.TYPE_ERROR)
            }
        });
//		parent.document.getElementById("rightContent").setAttribute("src", "list-shared.html")
	})
});

</script>
</html>
